#!/bin/bash
#$ -l mem_free=100G,h_vmem=100G
#$ -e /cluster/ifs/projects/seqSim/DataScienceHackathon2016/GenomeGraph/bwamem_genome_aligns/logs
#$ -o /cluster/ifs/projects/seqSim/DataScienceHackathon2016/GenomeGraph/bwamem_genome_aligns/logs

export GENOMEDIR=$1
export GENOMEFASTA=`head -$SGE_TASK_ID $GENOMEDIR/filelist.fof | tail -1`
export OUTPUT=`echo $GENOMEFASTA | sed 's:.*/::' | sed 's:.fa.*:.bam:'`
export REFDIR=/cluster/ifs/projects/seqSim/DataScienceHackathon2016/GenomeGraph/GRCh38_ref

echo $GENOMEFASTA $OUTPUT $REFDIR
echo $REFDIR/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa

/home/nhansen/projects/bwa/bwa-0.7.15/bwa mem $REFDIR/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa $GENOMEFASTA | samtools view -t $REFDIR/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa.fai -u -o $OUTPUT - 

