bwa index GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa


/home/nhansen/projects/bwa/bwa-0.7.15/bwa mem GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa input_sequences.fa  | samtools view -Sb - > input_sequences_unsorted.bam
samtools sort -o input_sequences.bam input_sequences_unsorted.bam
samtools index input_sequences.bam

# Check that there are no unmapped reads in the input BAM because might lead to unknown behaviour:

samtools view -c -f 0x4 /data/projects/phillippy/projects/hackathon/shared/alignments/SevenGenomesPlusGRCh38Alts.bam
[diltheyat@gry-compute50 /data/projects/phillippy/projects/hackathon/Graph_Genomes_CSHL/scripts]:./BAM2AARTI.pl --BAM /data/projects/phillippy/projects/hackathon/shared/alignments/SevenGenomesPlusGRCh38Alts.bam --referenceFasta /data/projects/phillippy/projects/hackathon/shared/reference/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa --readsFasta /data/projects/phillippy/projects/hackathon/shared/contigs/AllContigs.fa --outputFile /data/projects/phillippy/projects/hackathon/intermediate_files/AartiInput

# Check that /data/projects/phillippy/projects/hackathon/intermediate_files/AartiInput.sortedWithHeader is NEW and was created correctly!

[diltheyat@gry-compute50 /data/projects/phillippy/projects/hackathon/Graph_Genomes_CSHL/scripts]:./FIND_GLOBAL_ALIGNMENTS.pl --alignmentsFile /data/projects/phillippy/projects/hackathon/intermediate_files/AartiInput.sortedWithHeader --referenceFasta /data/projects/phillippy/projects/hackathon/shared/reference/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa --outputFile /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT.bam --outputTruncatedReads /data/projects/phillippy/projects/hackathon/intermediate_files/truncatedReads --outputReadLengths /data/projects/phillippy/projects/hackathon/intermediate_files/postGlobalAlignment_readLengths


[diltheyat@gry-compute50 /data/projects/phillippy/projects/hackathon/Graph_Genomes_CSHL/scripts] ./BAM2MAFFT.pl --BAM /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT.bam --referenceFasta /data/projects/phillippy/projects/hackathon/shared/reference/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa --readsFasta /data/projects/phillippy/projects/hackathon/shared/contigs/AllContigs.fa --outputDirectory /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT --inputTruncatedReads /data/projects/phillippy/projects/hackathon/intermediate_files/truncatedReads 

PATH=$PATH:/data/projects/phillippy/projects/rDNA/mafft/mafft-7.273-with-extensions/install/bin/

./CALLMAFFT.pl --action kickOff --mafftDirectory /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT --qsub 1
./CALLMAFFT.pl --action check --mafftDirectory /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT
./CALLMAFFT.pl --action reprocess --mafftDirectory /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT

####  /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT/_windowsInfo

./globalize_windowbams.pl --fastadir /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT/ --msadir /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT/ --bamheader /data/projects/phillippy/projects/hackathon/Graph_Genomes_CSHL/config/GRCh38.headerfile.txt --contigs /data/projects/phillippy/projects/hackathon/intermediate_files/postGlobalAlignment_readLengths --output /data/projects/phillippy/projects/hackathon/intermediate_files/combined.bam

./checkMAFFT_input_and_output.pl --MAFFTdir /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT/ --contigLengths /data/projects/phillippy/projects/hackathon/intermediate_files/postGlobalAlignment_readLengths --preMAFFTBAM /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT.bam --finalOutputBAM /data/projects/phillippy/projects/hackathon/intermediate_files/combined_sorted.bam

# print SAM output

./globalize_windowbams.pl --fastadir /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT/ --msadir /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT/ --contigs /data/projects/phillippy/projects/hackathon/intermediate_files/postGlobalAlignment_readLengths --output /data/projects/phillippy/projects/hackathon/intermediate_files/combined.sam;\
cat /data/projects/phillippy/projects/hackathon/intermediate_files/combined.sam | samtools view -u -t /data/projects/phillippy/projects/hackathon/Graph_Genomes_CSHL/config/GRCh38.headerfile.txt - >  /data/projects/phillippy/projects/hackathon/intermediate_files/combined.bam;\
samtools sort /data/projects/phillippy/projects/hackathon/intermediate_files/combined.bam > /data/projects/phillippy/projects/hackathon/intermediate_files/combined_sorted.bam;\
samtools index /data/projects/phillippy/projects/hackathon/intermediate_files/combined_sorted.bam;\
./checkMAFFT_input_and_output.pl --MAFFTdir /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT/ --contigLengths /data/projects/phillippy/projects/hackathon/intermediate_files/postGlobalAlignment_readLengths --preMAFFTBAM /data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT.bam --finalOutputBAM /data/projects/phillippy/projects/hackathon/intermediate_files/combined_sorted.bam &> output_checkMAFFT4

./validate_BAM_MSA.pl --BAM /data/projects/phillippy/projects/hackathon/intermediate_files/combined_sorted.bam --referenceFasta /data/projects/phillippy/projects/hackathon/shared/reference/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa


./BAM2VCF.pl --BAM /data/projects/phillippy/projects/hackathon/intermediate_files/combined_sorted.bam --referenceFasta /data/projects/phillippy/projects/hackathon/shared/reference/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa --output VCF/uber_vcf.vcf




gg-wrapper-bam2vcf.pl --script BAM2VCF.pl --BAM /data/projects/phillippy/projects/hackathon/intermediate_files/combined.bam --referenceFasta /data/projects/phillippy/projects/hackathon/shared/reference/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa --window 100000 --samples /data/projects/phillippy/projects/hackathon/Graph_Genomes_CSHL/examples/list_of_assemblies.txt --outputDirectory /data/projects/phillippy/projects/hackathon/intermediate_files/forVG | parallel -j 8

./gg-wrapper-bam2vcf.pl --script ./BAM2VCF.pl --BAM uber_sorted.bam --referenceFasta /data/projects/phillippy/projects/hackathon/shared/reference/GRCh38_full_plus_hs38d1_analysis_set_minus_alts.fa --window 10000000 --samples /data/projects/phillippy/projects/hackathon/Graph_Genomes_CSHL/examples/list_of_assemblies.txt --outputDirectory /data/projects/phillippy/projects/hackathon/intermediate_files/forVG  | parallel -j 8



## We have a BAM with a missing sequence -- check what is going on here
	/data/projects/phillippy/projects/hackathon/intermediate_files/forMAFFT//chr21/chr21_794.bam
	NA19240.gi|939190542|gb|LKPB01002076.1|

	Re-executing fas2bam solves that problem
	
